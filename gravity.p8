pico-8 cartridge // http://www.pico-8.com
version 34
__lua__
--gravity
--patreon.com/mboffin


function _init()	

	ball0 = ball_setup({})
	ball1 = ball_setup({})

end

function _update()
	reset_ball(ball0)
	reset_ball(ball1)

	check_buttons()

 	if (btnp(0) or btnp(1) or btnp(2)) then
  		sfx(1)
 	end

	move_ball(ball0)
	move_ball(ball1)

	check_collision(ball0, ball1)

end

function _draw()
	cls()
	
	draw_ball(ball0)
	draw_ball(ball1)
	
	--draw the ground
	rectfill(0,112,127,127,4)

	--draw the instructions
	print("⬅️ ⬆️ ➡️ to bump the ball",15,119,0)
	print("⬅️ ⬆️ ➡️ to bump the ball",14,118,11)
end




-->8
--ball functions

function ball_setup(b)
	b.x=64
	b.y=32
	
	b.dx=0		--velocity
	b.dy=0

	b.s=4		--size
	b.c=3  		--color
	b.spinning=false
	b.nudging_left=false
	b.nudging_right=false
	b.nudging_up=false

	wall_l=0
	wall_r=127
	ceiling=0
	floor=111

	g=0.5

	bump_up=-8	--bump force (⬆️)
	bump_lr=4		--bump force (⬅️➡️)
	bounce=0.8
	
	return b
end

function check_buttons()
	if (btnp(0, 0)) ball0.dx=-bump_lr;ball0.nudging_left=true
	if (btnp(1, 0)) ball0.dx=bump_lr;ball0.nudging_right=true
	if (btnp(2, 0)) ball0.dy=bump_up;ball0.nudging_up=true
	if (btnp(5, 0)) ball0.dy=0;ball0.dx=0

	if (btnp(0, 1)) ball1.dx=-bump_lr;ball1.nudging_left=true
	if (btnp(1, 1)) ball1.dx=bump_lr;ball1.nudging_right=true
	if (btnp(2, 1)) ball1.dy=bump_up;ball1.nudging_up=true
	if (btnp(5, 1)) ball1.dy=0;ball1.dx=0
end

function reset_ball(b)
	b.spinning=false
	b.nudging_left=false
	b.nudging_right=false
	b.nudging_up=false
end

function move_ball(b)
	
	b.dy+=g 
	b.x+=b.dx
	b.y+=b.dy

	check_wall_bounce(b)
	
	--some games check the bounce
	--before changing position and
	--some games check afterward.
	--the danger of checking after
	--is that sometimes it can look
	--like your object goes into
	--a wall before it bounces off.
	--the danger of checking before
	--is that sometimes it can look
	--like your object never 
	--actually touches the wall 
	--before it bounces. it is up 
	--to you to see which method 
	--works best for your game!
end

function draw_ball(b)
	if (b.nudging_left) circfill(b.x+2,b.y,b.s,7)
	if (b.nudging_right) circfill(b.x-2,b.y,b.s,7)
	if (b.nudging_up) circfill(b.x,b.y+2,b.s,7)
 
	circfill(b.x,b.y,b.s,b.c)
end

function check_wall_bounce(b)
	local left=b.x-b.s
	local right=b.x+b.s
	local top=b.y-b.s
	local bottom=b.y+b.s

	if (bottom>floor) then
	
		b.dy*=-1
	 
	 	b.dy*=bounce

	 	b.y=floor-b.s

		if (abs(b.dy)>0.75) sfx(0)
	 
	elseif (top<ceiling) then
		
		b.dy*=-bounce
		
		b.y=b.s

		sfx(0)
	end
	
	if (left<wall_l) then
		b.dx*=-bounce
		b.x=b.s
		sfx(0)
	elseif (right>wall_r) then
		b.dx*=-bounce
		b.x=127-b.s
		sfx(0)
	end	
	
end

function check_collision(b0, b1)
	-- TODO CWS: make this collision more complex
	local left0=b0.x-b0.s
	local right0=b0.x+b0.s
	local top0=b0.y-b0.s
	local bottom0=b0.y+b0.s

	local left1=b1.x-b1.s
	local right1=b1.x+b1.s
	local top1=b1.y-b1.s
	local bottom1=b1.y+b1.s

	-- TODO CWS: find slope of the line and adjust dx and dy accordingly
	if (circles_overlap(b0, b1)) then
		sfx(0)
	end

end

function circles_overlap(b0, b1)
	local distance = math.sqrt((b0.x - b1.x) ^ 2 + (b0.y - b1.y) ^ 2)
	return distance > (b0.s + b1.s) and distance >= math.abs(b0.s - b1.s)
end

function apply_knockback(ball0, ball1, direction)
	local faster_ball = faster_ball(ball0, ball1)
	if faster_ball == 0 then
	else 

	end


end

function faster_ball(ball0, ball1)
	if absolute_velocity(ball0.dx, ball0.dy) > absolute_velocity(ball1.dx, ball1.dy) then
		return 0
	elseif absolute_velocity(ball1.dx, ball1.dy) > absolute_velocity(ball0.dx, ball0.dy) then 
		return 1
	end
end

function absolute_velocity(dx, dy)
	math.sqrt(dx^2 + dy^2)
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000099900000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009999999000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009999999000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000099999999900000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000099999999900000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000099999999900000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009999999000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000009999999000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000099900000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
444444444444444bbbbb4444444bbbbb4444444bbbbb444444bbb44bb44444bbb4b4b4bbb4bbb44444bbb4b4b4bbb44444bbb4bbb4b444b44444444444444444
44444444444444bbb00bb44444bbb0bbb44444bb00bbb444444b00b4b04444b0b0b0b0bbb0b0b044444b00b0b0b0004444b0b0b0b0b044b04444444444444444
44444444444444bb004bb04444bb004bb04444bb044bb044444b04b0b04444bb40b0b0b0b0bbb044444b04bbb0bb444444bb40bbb0b044b04444444444444444
44444444444444bbb44bb04444bb044bb04444bb04bbb044444b04b0b04444b0b4b0b0b0b0b00044444b04b0b0b0044444b0b4b0b0b044b04444444444444444
444444444444444bbbbb0044444bbbbb0044444bbbbb0044444b04bb404444bbb04bb0b0b0b04444444b04b0b0bbb44444bbb0b0b0bbb4bbb444444444444444
44444444444444440000044444440000044444440000044444440440044444400044004040404444444404404040004444400040404000400044444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444

__sfx__
000200000e3500c3500b3500c3501235018350190001b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00030000190500f0500a0500705005050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
